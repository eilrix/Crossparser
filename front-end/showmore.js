!function(t){var e={};function o(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(a,i,function(e){return t[e]}.bind(null,i));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";function a(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}o.r(e),$(document).ready(function(){var t=new i;window.pageHandler=t,t.init()});var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fixMegafilterPagination=function(){var t=$("#res-products .text-center .pagination li a");this.$paginationBottom=t,0!=t.length&&t.each(function(e){var o=jQuery(t[e]).attr("href"),a=o.split("?"),i=a[a.length-1].split("=");"page"==i[0]&&(i=i[i.length-1],o=window.location.href+"&page="+i,jQuery(t[e]).attr("href",o))})}.bind(this),this.initMegafilterOnWideScreen=function(){var t=this;$(".pagination").before('<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"><\/script>'),this.$items=$("#mfilter-box-1 .mfilter-filter-item"),$("#mfilter-box-1").detach().appendTo("#content .row.sort-row"),$("#column-left").css({width:"15%"}),$("#column-left + #content").css({width:"85%"});var e=$("#grid-view"),o=function(){t.$focused_item.find("> .mfilter-content-opts").slideUp("normal"),t.$focused_item.find("> .mfilter-heading").addClass("mfilter-collapsed")};$("body").click(function(a){var i,n=$(a.target);0!=t.$items.has(n).length||n[0]==e[0]?t.$items.has(n).length>0&&(t.$items.each(function(e){0!=$(t.$items[e]).has(n).length&&(i=$(t.$items[e]))}),""==t.$focused_item&&(t.$focused_item=i),i[0]!=t.$focused_item[0]&&(o(),t.$focused_item=i)):""!=t.$focused_item&&(o(),t.$focused_item="")}),this.is_mf_attached=!1}.bind(this),this.attachMFandCategs=function(){var t=$("#res-products").height()+$("#res-products").offset().top-700;if($("#sstore-3-level").hasClass("column-left-attached")?this.is_mf_attached=!0:this.is_mf_attached=!1,$(".sort-row-wrapper").height(),window.pageYOffset>520&&window.pageYOffset<t&&!this.is_mf_attached){this.is_mf_attached=!0,console.log(),console.log("attach!"),console.log("window.pageYOffset",window.pageYOffset),console.log("max_height",t);var e=$(".sort-row-wrapper").height();$(".sort-row-wrapper").css({height:e}),$("#content .row.sort-row").addClass("sortrow-attached"),$("#sstore-3-level").addClass("column-left-attached")}(window.pageYOffset<520||window.pageYOffset>t)&&this.is_mf_attached&&($("#content .row.sort-row").css({top:"0"}),$("#content .row.sort-row").removeClass("sortrow-attached"),$("#sstore-3-level").removeClass("column-left-attached"),this.is_mf_attached=!1)}.bind(this),this.isSearchPage="",this.isProductPage="",this.storeClassesOfProd="",this.$topPaginationContainer="",this.prodId="",this.autof_settings="",this.productsLoaded=0,this.fewProdsInCategory=!1,this.firstFlagLoadAutoFeatured=!0,this.paginationTop="",this.$focused_item="",this.$items="",this.$paginationBottom="",this.is_mf_attached=""}var e,o,i;return e=t,(o=[{key:"init",value:function(){console.log("showmore init"),this.isSearchPage=document.querySelector("h2.search-header"),this.isProductPage=document.querySelector("h1.product-header"),this.isProductPage||(jQuery(window).width()>992&&this.initMegafilterOnWideScreen(),this.fixMegafilterPagination()),this.getReadyToShowMore()}},{key:"getReadyToShowMore",value:function(){$(".pagination li.active").next("li").children("a").length>0&&$(".pagination").before('<div id="showmore" class="showmoreBtn" style="padding-bottom: 15px;"><a id="showmore-text-btn" onclick="showmore()">Показать еще</a><img id="load-more-gif"  style="display: none; margin: 0px auto;" src="image/loading.gif"></div>'),this.loadMoreIfNotEnough(),this.$paginationBottom=$("#res-products .text-center .pagination"),0!=this.$paginationBottom.length&&(this.$topPaginationContainer=$("body"),this.paginationTop=this.$paginationBottom.clone(),this.$topPaginationContainer.append(this.paginationTop),this.paginationTop.css({position:"fixed",bottom:"10px",opacity:"0.8",right:"0","z-index":"9","background-color":"#fff","box-shadow":"0 1px 9px rgba(0, 0, 0, .3)"}))}},{key:"reloadShowMoreAfterFilter",value:function(){void 0!==this.paginationTop&&this.paginationTop.remove(),$(".autofeatured").length>0&&$(".autofeatured").remove(),$(".showmoreBtn").length>0&&$(".showmoreBtn").remove(),$("#showmore").length>0&&$("#showmore").remove(),$(".autofeaturedText").length>0&&$(".autofeaturedText").remove(),this.fewProdsInCategory=!1,this.firstFlagLoadAutoFeatured=!0,this.productsLoaded=0,$("#oct-slide-panel > ul").length>0&&$("#oct-slide-panel > ul").remove(),$(".cat-desc-box").length>0&&$(".cat-desc-box").remove(),this.fixMegafilterPagination(),this.getReadyToShowMore()}},{key:"showmore",value:function(){var t=this,e=$(".pagination li.active").next("li").children("a");if(0!=e.length)return window.history.pushState(null,e.innerText,e.attr("href")),$.get(e.attr("href"),function(e){t.stopLoadingAnimation(),$data=$(e);var o=$data.find(".product-layout"),a=Array.from(o);t.isSearchPage&&(console.log(t.storeClassesOfProd),a.forEach(function(e){e.classList=t.storeClassesOfProd})),$("#res-products .row:first-child").append(a),$(".pagination").html($data.find(".pagination > *")),0==$(".pagination li.active").next("li").children("a").length&&$("#showmore").hide(),$data.filter("script").each(function(){(this.text||this.textContent||this.innerHTML).indexOf("document.write")>=0||$.globalEval(this.text||this.textContent||this.innerHTML||"")});var i=t.paginationTop;void 0!==i&&i.remove(),i=t.$paginationBottom.clone(),t.$topPaginationContainer.append(i),i.css({position:"fixed",bottom:"10px",opacity:"0.8",right:"0","z-index":"9","background-color":"#fff",color:"#141414","box-shadow":"0 1px 9px rgba(0, 0, 0, .3)"}),$(".wishlist.oct-button").addClass("cbutton--effect-nikola"),$(".wishlist.oct-button").addClass("cbutton"),bindEffectForCButton()},"html"),startLoadingAnimation(),!1}},{key:"startLoadingAnimation",value:function(){var t=$("#load-more-gif"),e=$("#showmore-text-btn");t.css("display","block"),e.css("display","none")}},{key:"stopLoadingAnimation",value:function(){var t=$("#load-more-gif");$("#showmore-text-btn").css("display","block"),t.css("display","none")}},{key:"autoLoadInScroll",value:function(){var t=this,e=!0;if(null!=document.getElementById("showmore-text-btn")){var o=document.getElementById("showmore-text-btn").getBoundingClientRect();window.onscroll=function(){if(null!=document.getElementById("showmore-text-btn")){if((o=document.getElementById("showmore-text-btn").getBoundingClientRect()).top>2500&&(e=!0),o.top<1500&&e){if(t.isProductPage||t.fewProdsInCategory)return t.loadAutoFeatured(),void(e=!1);t.showmore(),e=!1}jQuery(window).width()>992&&(t.isProductPage||t.attachMFandCategs())}else console.log("autoLoadInScroll error")}}else console.log("autoLoadInScroll error")}},{key:"loadMoreIfNotEnough",value:function(){var t=this;if(document.getElementById("autofeatured_settings")&&""==this.autof_settings&&(this.autof_settings=document.getElementById("autofeatured_settings").innerText),this.isProductPage)return this.prodId=document.getElementById("LoadMoreHere").innerText,document.getElementById("LoadMoreHere").innerText="",$("#LoadMoreHere").append('<h3 class="autofeaturedText" class="autofeatured-selected"><a id="autofeatured_btn">Рекомендуемые товары</a><a id="imagematch_btn">Визуально похожие товары</a></h3>'),$("#LoadMoreHere").after('<div id="showmore" class="showmoreBtn col-sm-12" style="padding-top: 15px;"><a id="showmore-text-btn" onclick="pageHandler.loadAutoFeatured()">Показать еще</a><img id="load-more-gif"  style="display: none; margin: 0px auto;" src="image/loading.gif"></div>'),$("#autofeatured_btn").addClass("autofeatured-selected"),$("#imagematch_btn").click(function(){$(".row.autofeatured").remove(),$("#imagematch_btn").addClass("autofeatured-selected"),$("#autofeatured_btn").removeClass("autofeatured-selected"),t.loadImgMatch()}),$("#autofeatured_btn").click(function(){$(".row.autofeatured").remove(),$("#imagematch_btn").removeClass("autofeatured-selected"),$("#autofeatured_btn").addClass("autofeatured-selected"),t.productsLoaded=0,t.autoLoadInScroll(),t.loadAutoFeatured()}),this.autoLoadInScroll(),void this.loadAutoFeatured();jQuery(window).width()>992&&(window.onscroll=function(){t.isProductPage||t.attachMFandCategs()});var e=document.querySelectorAll("#res-products .row .product-layout"),o=Array.from(e);if(e&&(o.length>30&&this.autoLoadInScroll(),this.storeClassesOfProd=o[0].classList,o.length<20)){this.fewProdsInCategory=!0;var a=o[0].querySelector(".quick-view a").getAttribute("onclick");this.prodId=a.split("(")[1].replace("'","").replace("')","").replace(";",""),this.loadAutoFeatured(),$(".container .content-row").append('<h3 class="autofeaturedText">Похожие товары</h3>')}}},{key:"loadAutoFeatured",value:function(){var t=this;if(null==this.isProductPage){var e=document.querySelectorAll("#res-products .row .product-layout"),o=Array.from(e)[0].querySelector(".quick-view a").getAttribute("onclick");this.prodId=o.split("(")[1].replace("'","").replace("')","").replace(";","")}console.log("prodId: ",this.prodId,"productsLoaded: ",this.productsLoaded),console.log("autof_settings",this.autof_settings);var a={autof_settings:this.autof_settings,prodId:this.prodId,productsLoaded:this.productsLoaded};this.startLoadingAnimation(),$.ajax({type:"POST",url:"index.php?route=extension/module/autofeatured/ajaxGetProduct",data:a}).done(function(e){console.log("post: ",e),t.stopLoadingAnimation(),t.isProductPage?$("#LoadMoreHere").append(e):($(".container .content-row").append(e),t.firstFlagLoadAutoFeatured&&(t.firstFlagLoadAutoFeatured=!1,$("footer").before('<div id="showmore" class="showmoreBtn" style="padding-top: 15px;"><a id="showmore-text-btn" onclick="loadAutoFeatured()">Показать еще</a><img id="load-more-gif"  style="display: none; margin: 0px auto;" src="image/loading.gif"></div>'),t.autoLoadInScroll()))}),this.productsLoaded+=40}},{key:"loadImgMatch",value:function(){if(null==this.isProductPage){var t=document.querySelectorAll("#res-products .row .product-layout"),e=Array.from(t)[0].querySelector(".quick-view a").getAttribute("onclick");this.prodId=e.split("(")[1].replace("'","").replace("')","").replace(";","")}var o=$("#product > div:nth-child(7) > span.product-sizes-span").text();console.log("prodId: ",this.prodId,"productsLoaded: ",this.productsLoaded),console.log("autof_settings",this.autof_settings);var a={autof_settings:this.autof_settings,prodId:o,productsLoaded:this.productsLoaded};this.startLoadingAnimation(),$.ajax({type:"POST",url:"index.php?route=extension/module/autofeatured/ajaxGetImgMatched",data:a}).done(function(t){console.log("post: ",t),this.stopLoadingAnimation(),this.isProductPage?$("#LoadMoreHere").append(t):($(".container .content-row").append(t),this.firstFlagLoadAutoFeatured&&(this.firstFlagLoadAutoFeatured=!1,$("footer").before('<div id="showmore" class="showmoreBtn" style="padding-top: 15px;"><a id="showmore-text-btn" onclick="loadAutoFeatured()">Показать еще</a><img id="load-more-gif"  style="display: none; margin: 0px auto;" src="image/loading.gif"></div>'),this.autoLoadInScroll()))}),this.productsLoaded+=40}},{key:"customCallAutofeatured",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".container .content-row";window.onscroll={};var a={prodId:t,productsLoaded:e};this.startLoadingAnimation(),$.ajax({type:"POST",url:"index.php?route=extension/module/autofeatured/ajaxGetProduct",data:a}).done(function(t){console.log("post: ",t),this.stopLoadingAnimation(),this.isProductPage?$("#LoadMoreHere").append(t):$(o).append(t)}).fail(function(){console.log("error"),this.stopLoadingAnimation()})}},{key:"customCallImgMatch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".container .content-row";window.onscroll={};var a={prodId:t,productsLoaded:e};this.startLoadingAnimation(),$.ajax({type:"POST",url:"index.php?route=extension/module/autofeatured/ajaxGetImgMatched",data:a}).done(function(t){console.log("post: ",t),this.stopLoadingAnimation(),this.isProductPage?$("#LoadMoreHere").append(t):$(o).append(t)}).fail(function(){console.log("error"),this.stopLoadingAnimation()})}}])&&a(e.prototype,o),i&&a(e,i),t}();e.default=i}]);